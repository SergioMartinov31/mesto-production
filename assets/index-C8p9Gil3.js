(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();const s={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"80d6473f-2e6d-4fb5-9bff-d31ba3a41068","Content-Type":"application/json"}},i=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),Y=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(i),N=()=>fetch(`${s.baseUrl}/cards`,{headers:s.headers}).then(i),Z=({name:e,about:t})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then(i),ee=e=>fetch(`${s.baseUrl}/users/me/avatar`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(i),te=(e,t)=>fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then(i),oe=e=>fetch(`${s.baseUrl}/cards/${e}`,{method:"DELETE",headers:s.headers}).then(i),re=(e,t)=>fetch(`${s.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:s.headers}).then(o=>i(o)),ne=e=>{e.classList.toggle("card__like-button_is-active")},ce=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),O=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:r,onInfoClick:n},c)=>{const l=ce(),S=l.querySelector(".card__like-button"),X=l.querySelector(".card__like-count"),D=l.querySelector(".card__control-button_type_delete"),v=l.querySelector(".card__image");return v.src=e.link,v.alt=e.name,X.textContent=e.likes.length||null,e.likes.some(w=>w._id===c)&&S.classList.add("card__like-button_is-active"),l.querySelector(".card__title").textContent=e.name,o&&S.addEventListener("click",()=>o(S,e._id)),r?D.addEventListener("click",()=>r(e._id,l)):D.remove(),t&&v.addEventListener("click",()=>t({name:e.name,link:e.link})),n&&l.querySelector(".card__control-button_type_info").addEventListener("click",()=>n(e._id)),l},W=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");u(t)}},d=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",W)},u=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",W)},se=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{u(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&u(e)})},A=(e,t,o,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)},H=(e,t,o)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass),r.textContent=""},le=(e,t,o)=>{if(t.validity.patternMismatch){const r=t.dataset.errorMessage||t.validationMessage;A(e,t,r,o)}else t.validity.valid?H(e,t,o):A(e,t,t.validationMessage,o)},ae=e=>e.some(t=>!t.validity.valid),C=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},ue=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},U=(e,t,o)=>{ae(e)?C(t,o):ue(t,o)},ie=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);U(o,r,t),o.forEach(n=>{n.addEventListener("input",function(){le(e,n,t),U(o,r,t)})})},g=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);C(r,t),o.forEach(n=>{H(e,n,t)}),C(r,t)},pe=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{o.addEventListener("submit",function(r){r.preventDefault()}),ie(o,e)})},j=document.querySelector(".places__list"),k=document.querySelector(".popup_type_edit"),y=k.querySelector(".popup__form"),J=y.querySelector(".popup__input_type_name"),V=y.querySelector(".popup__input_type_description"),E=document.querySelector(".popup_type_new-card"),p=E.querySelector(".popup__form"),de=p.querySelector(".popup__input_type_card-name"),_e=p.querySelector(".popup__input_type_url"),I=document.querySelector(".popup_type_image"),$=I.querySelector(".popup__image"),me=I.querySelector(".popup__caption"),fe=document.querySelector(".profile__edit-button"),ye=document.querySelector(".profile__add-button"),x=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),T=document.querySelector(".profile__image"),M=document.querySelector(".popup_type_edit-avatar"),f=M.querySelector(".popup__form"),he=f.querySelector(".popup__input"),P=document.querySelector(".popup_type_remove-card"),R=P.querySelector(".popup__form");let L=null,q=null;const z=(e,t)=>{L=e,q=t,d(P)},be=e=>{const t=R.querySelector(".popup__button"),o=t.textContent;e.preventDefault(),a(t,!0,o,"Удаление..."),oe(L).then(()=>{q.remove(),u(P),L=null,q=null}).catch(r=>{console.log("Ошибка удаления:",r)}).finally(()=>{a(t,!1,o)})};R.addEventListener("submit",be);const K=(e,t)=>{const o=e.classList.contains("card__like-button_is-active"),r=e.nextElementSibling;re(t,o).then(n=>{r.textContent=n.likes.length||null,ne(e)}).catch(n=>{console.log("Ошибка изменения статуса лайка:",n)})},G=({name:e,link:t})=>{$.src=t,$.alt=e,me.textContent=e,d(I)},a=(e,t,o="Сохранить",r="Сохранение...")=>{t?(e.textContent=r,e.disabled=!0):(e.textContent=o,e.disabled=!1)},Se=e=>{const t=y.querySelector(".popup__button"),o=t.textContent;e.preventDefault(),a(t,!0,o),Z({name:J.value,about:V.value}).then(r=>{x.textContent=r.name,B.textContent=r.about,u(k)}).catch(r=>{console.log(r)}).finally(()=>{a(t,!1,o)})},ve=e=>{const t=f.querySelector(".popup__button"),o=t.textContent;e.preventDefault(),a(t,!0,o),ee(he.value).then(r=>{T.style.backgroundImage=`url(${r.avatar})`,u(M)}).catch(r=>{console.log(r)}).finally(()=>{a(t,!1,o)})},Ce=e=>{const t=p.querySelector(".popup__button"),o=t.textContent;e.preventDefault(),a(t,!0,o,"Создание..."),te(de.value,_e.value).then(r=>{j.prepend(O(r,{onPreviewPicture:G,onLikeIcon:K,onDeleteCard:z,onInfoClick:Q})),u(E)}).catch(r=>{console.log(r)}).finally(()=>{a(t,!1,o)})};y.addEventListener("submit",Se);p.addEventListener("submit",Ce);f.addEventListener("submit",ve);fe.addEventListener("click",()=>{J.value=x.textContent,V.value=B.textContent,g(y,b),d(k)});T.addEventListener("click",()=>{f.reset(),g(f,b),d(M)});ye.addEventListener("click",()=>{p.reset(),g(p,b),d(E)});const Le=document.querySelectorAll(".popup");Le.forEach(e=>{se(e)});const b={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};pe(b);Promise.all([N(),Y()]).then(([e,t])=>{const o=t._id;e.forEach(r=>{j.append(O(r,{onPreviewPicture:G,onLikeIcon:K,onDeleteCard:o===r.owner._id?z:null,onInfoClick:Q},o))}),x.textContent=t.name,B.textContent=t.about,T.style.backgroundImage=`url(${t.avatar}`}).catch(e=>{console.log(e)});const m=document.querySelector(".popup_type_info"),_=m.querySelector(".popup__info"),F=m.querySelector(".popup__list"),qe=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),h=(e,t)=>{const r=document.getElementById("popup-info-definition-template").content.cloneNode(!0);return r.querySelector(".popup__info-term").textContent=e,r.querySelector(".popup__info-description").textContent=t,r},Q=e=>{N().then(t=>{const o=t.find(r=>r._id===e);m.querySelector(".popup__title").textContent="Информация о карточке",_.innerHTML="",_.append(h("Описание:",o.name)),_.append(h("Дата создания:",qe(new Date(o.createdAt)))),_.append(h("Владелец:",o.owner.name)),_.append(h("Количество лайков:",o.likes.length)),m.querySelector(".popup__text").textContent="Лайкнули:",F.innerHTML="",o.likes.forEach(r=>{const c=document.getElementById("popup-info-user-preview-template").content.cloneNode(!0);c.querySelector(".popup__list-item_type_badge").textContent=r.name,F.append(c)}),d(m)}).catch(t=>{console.log(t)})};
